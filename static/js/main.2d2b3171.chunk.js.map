{"version":3,"sources":["httpRequest.js","mafia.js","panels/RegistredPlayers.js","panels/UserPanel.js","panels/Home.js","panels/EditPanel.js","panels/Register.js","App.js","index.js"],"names":["httpRequest","method","url","data","Promise","resolve","reject","xhr","XMLHttpRequest","open","onload","this","status","response","error","Error","statusText","code","onerror","JSON","stringify","send","httpRequestJSON","a","async","json","parse","console","warn","api_url","players","game","get","apiMethod","post","load","what","loadPlayers","loadGame","getPlayer","id","getPlayerByNickname","nickname","Object","keys","length","pid","getPlayers","isPlayerInGame","getGamePlayers","registerPlayer","ok","addToGame","signup_for_game","setNickname","assign","updatePlayer","options","opts","name","sex","updateMafia","RegistredPlayers","props","state","title","view","size","fetching","renderPlayers","bind","onRefresh","setState","Mafia","then","connect","access_token","ids","push","vk_id","join","vk_users","users","uid","user","photo_200","jsx","isYoureRegistred","parseInt","fetchedUser","key","before","src","description","onClick","window","playersCount","playersWord","isFetching","React","Component","UserPanel","button","signup","confirmRegister","signed","cancelRegister","level","loading","style","paddingLeft","paddingRight","player","first_name","go","data-to","width","height","display","updateButton","register","setPopout","actions","autoclose","action","onClose","actionsLayout","success","in_game","photo","bottomContent","fontSize","Home","forceUpdate","osname","platform","EditPanel","nicknameExists","nickname_class","nickname_text","onChange","onSubmit","back","e","log","currentTarget","value","validChars","test","clearTimeout","TimerID","setTimeout","event","left","IOS","type","top","defaultChecked","bottom","osName","Register","responseText","App","useState","activePanel","setActivePanel","setUser","popout","useEffect","subscribe","detail","schemeAttribute","document","createAttribute","scheme","body","attributes","setNamedItem","fetchData","dataset","to","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.2d2b3171.chunk.js","sourcesContent":["export default function httpRequest (method, url, data) {\r\n    return new Promise(function(resolve, reject) {\r\n\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(method, url, true);\r\n\r\n        xhr.onload = function() {\r\n            if (this.status === 200) {\r\n                resolve(this.response);\r\n            } else {\r\n                var error = new Error(this.statusText);\r\n                error.code = this.status;\r\n                reject(error);\r\n            }\r\n        };\r\n\r\n        xhr.onerror = function() {\r\n            reject(\"Network Error\");\r\n        };\r\n\r\n        if (data && typeof data !== 'string') {\r\n            data = JSON.stringify(data);\r\n        }\r\n        xhr.send(data);\r\n    });\r\n}\r\n\r\nexport async function httpRequestJSON(method, url, data) {\r\n    let json = await httpRequest(method, url, data);\r\n    try {\r\n        let response = JSON.parse(json);\r\n        return response;\r\n    } catch (err) {\r\n        console.warn(`${method} '${url}' -> returns non-json response. Error:`, err);\r\n        return false;\r\n    }\r\n}\r\n","import {httpRequestJSON} from \"./httpRequest\";\r\n\r\nconst api_url = 'https://vkapp.mailpromtrans.ru/api/';\r\nlet players = null;\r\nlet game = null;\r\n\r\nfunction get(apiMethod, data) { return httpRequestJSON('GET', api_url + apiMethod, data) }\r\nfunction post(apiMethod, data) { return httpRequestJSON('POST', api_url + apiMethod, data) }\r\nasync function load(what) {\r\n    let data = await get(what);\r\n    if (data === false)\r\n        return [];\r\n\r\n    if (what === 'players' && 'players' in data) {\r\n        players = data.players;\r\n        return players;\r\n    } else if (what === 'game' && 'players' in data) {\r\n        game = data.players;\r\n        return game;\r\n    } else\r\n        console.warn(`Cannot find {response}.players from request to '${what}' API`);\r\n\r\n}\r\nfunction loadPlayers() { return load('players') }\r\nfunction loadGame() { return load('game') }\r\n\r\n/**\r\n * Получение информации об игроке из БД Мафии\r\n * @param {int} id ID пользователя ВКонтакте\r\n * @return {array|bool} Array с данными игрока, False если игрока не существует\r\n */\r\nasync function getPlayer(id) {\r\n    if (!players || !players[id]) await loadPlayers();\r\n    if (id in players) return players[id];\r\n    return false;\r\n}\r\n\r\nasync function getPlayerByNickname(nickname) {\r\n    if (players === null || !Object.keys(players).length) await loadPlayers();\r\n    for (let pid in players) {\r\n        if (players[pid].nickname === nickname)\r\n            return players[pid];\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Зарегистрирован ли игрок на игру\r\n * @param {int} id ID пользователя ВКонтакте\r\n * @return {bool} true если да, false если нет\r\n */\r\nasync function isPlayerInGame(id) {\r\n    if (!game) await loadGame();\r\n    return id in game;\r\n}\r\n\r\n/**\r\n * Получение списка игроков, зарегистрированных в БД Мафии\r\n * @return {array} Массив игроков\r\n */\r\nasync function getPlayers() {\r\n    if (players) return players;\r\n    await loadPlayers();\r\n    return players;\r\n}\r\n\r\n/**\r\n * Получение списка игроков, записавшихся на игру\r\n * @return {array} Массив игроков\r\n */\r\nasync function getGamePlayers() {\r\n    if (game) return game;\r\n    await loadGame();\r\n    return game;\r\n}\r\n\r\n/**\r\n * Установка нового ника игроку\r\n * @param {int} id ID пользователя ВКонтакте\r\n * @param {string} nickname Ник игрока\r\n */\r\nasync function setNickname(id, nickname) {\r\n    let data = await post('players', {\r\n        id: id,\r\n        nickname: nickname,\r\n    });\r\n\r\n    if (data === false || data.ok === false)\r\n        return false;\r\n\r\n    players[id] = Object.assign(players[id], data.players[id]);\r\n    return true;\r\n}\r\n\r\nasync function updatePlayer(id, options) {\r\n    let opts = { id: id };\r\n    options.name && (opts.name = options.name);\r\n    options.nickname && (opts.nickname = options.nickname);\r\n    options.sex && (opts.sex = options.sex);\r\n    let data = await post('players', opts);\r\n\r\n    if (data === false || data.ok === false)\r\n        return false;\r\n\r\n    players[id] = Object.assign(players[id], data.players[id]);\r\n    return true;\r\n}\r\n\r\n/**\r\n * Обновление списка игроков\r\n * @return {true} Всегда true по окончанию обновления\r\n */\r\nasync function updateMafia() {\r\n    await loadPlayers();\r\n    await loadGame();\r\n    return true;\r\n}\r\n\r\n/**\r\n * Регистрирует игрока в БД мафии\r\n * @param {int} id ID пользователя ВКонтакте\r\n * @return {bool}\r\n */\r\nasync function registerPlayer(id) {\r\n    let data = await post('register', { id: id });\r\n    if (data === false || data.ok === false)\r\n        return false;\r\n    await loadPlayers();\r\n    return true;\r\n}\r\n\r\n/**\r\n * Записывает игрока на игру. Создаёт его, если игрока не существует\r\n * @param {int} id ID пользователя ВКонтакте\r\n * @return {bool}\r\n */\r\nasync function addToGame(id) {\r\n    let data = await post('register', { id: id, signup_for_game: true });\r\n    if (data === false || data.ok === false)\r\n        return false;\r\n\r\n    await loadPlayers();\r\n    await loadGame();\r\n    return true;\r\n}\r\n\r\nexport default { getPlayer, getPlayerByNickname, getPlayers, isPlayerInGame, getGamePlayers, registerPlayer, addToGame, setNickname, updatePlayer, updateMafia };\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport connect from '@vkontakte/vk-connect';\r\nimport { Group, Cell, Avatar, Div, PullToRefresh, Spinner } from '@vkontakte/vkui';\r\nimport Mafia from '../mafia';\r\n\r\nclass RegistredPlayers extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            title: \"Игроки\",\r\n            view: <Div><Spinner size='large' /></Div>,\r\n            fetching: false,\r\n        };\r\n\r\n        this.renderPlayers = this.renderPlayers.bind(this);\r\n\r\n        this.onRefresh = () => {\r\n            this.setState({ fetching: true });\r\n            this.renderPlayers();\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.renderPlayers();\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        this.renderPlayers();\r\n    }\r\n\r\n    renderPlayers() {\r\n        Mafia.getGamePlayers()\r\n        .then(players => {\r\n            this.players = players;\r\n            return connect.send(\"VKWebAppGetAuthToken\", {\"app_id\": 7288259, \"scope\": \"\"});\r\n        })\r\n        .then((response) => {\r\n            this.access_token = response.access_token;\r\n\r\n            let ids = [];\r\n            for (let pid in this.players) {\r\n                ids.push(this.players[pid].vk_id);\r\n            }\r\n            return connect.send(\"VKWebAppCallAPIMethod\", {\r\n                \"method\": \"users.get\",\r\n                \"params\": {\r\n                    \"user_ids\": ids.join(','),\r\n                    \"fields\": \"photo_200\",\r\n                    \"v\": \"5.103\",\r\n                    \"access_token\": this.access_token\r\n                }\r\n            });\r\n        })\r\n        .then(vk_users => {\r\n            let users = vk_users.response;\r\n            for (let uid in users) {\r\n                let user = users[uid];\r\n                this.players[user.id].photo_200 = users[uid].photo_200;\r\n            }\r\n\r\n            let jsx = [];\r\n            let isYoureRegistred = false;\r\n            if (this.players) {\r\n                for (let pid in this.players) {\r\n                    if (parseInt(pid) === this.props.fetchedUser.id) {\r\n                        isYoureRegistred = true;\r\n                        delete this.players[pid];\r\n                        continue;\r\n                    }\r\n                    jsx.push(<Cell\r\n                                 key={pid}\r\n                                 before={this.players[pid].photo_200 ? <Avatar src={this.players[pid].photo_200}/> : null}\r\n                                 description={this.players[pid].name}\r\n                                 onClick={() => { window.open(\"https://vk.com/id\"+pid) }}\r\n                             >{ this.players[pid].nickname }</Cell>);\r\n                }\r\n            }\r\n\r\n            let playersCount = Object.keys(this.players).length;\r\n            let playersWord = 'игрок';\r\n            if (playersCount <= 4 && playersCount >= 2 ) {\r\n                playersWord += 'a';\r\n            } else if (playersCount !== 1) {\r\n                playersWord += 'ов';\r\n            }\r\n            this.setState({\r\n                title: (isYoureRegistred ? 'Вы и ещё ' : '') + playersCount + ' ' + playersWord,\r\n                view: jsx,\r\n                fetching: false,\r\n            });\r\n        });\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <PullToRefresh onRefresh={this.onRefresh} isFetching={this.state.fetching}>\r\n                <Group title={this.state.title}>\r\n                    {this.state.view}\r\n                </Group>\r\n            </PullToRefresh>\r\n        );\r\n    }\r\n}\r\n\r\nRegistredPlayers.propTypes = {\r\n\tfetchedUser: PropTypes.shape({\r\n\t\tid: PropTypes.number,\r\n        photo_200: PropTypes.string,\r\n        name: PropTypes.string.isRequired,\r\n        nickname: PropTypes.string,\r\n\t\tfirst_name: PropTypes.string,\r\n\t\tlast_name: PropTypes.string,\r\n\t\tcity: PropTypes.shape({\r\n\t\t\ttitle: PropTypes.string,\r\n\t\t}),\r\n\t}),\r\n};\r\n\r\nexport default RegistredPlayers;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Alert, Cell, Group, Avatar, Button, Spinner } from '@vkontakte/vkui';\r\nimport Icon24Write from '@vkontakte/icons/dist/24/write';\r\n\r\n// import httpRequest from '../httpRequest';\r\nimport Mafia from '../mafia';\r\n\r\nclass UserPanel extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.button = {\r\n            signup: <Button onClick={() => this.confirmRegister()}>Записаться на игру</Button>,\r\n            signed: <Button onClick={() => this.cancelRegister()} level=\"secondary\">Вы записаны на игру</Button>,\r\n            loading: <Button level=\"secondary\" style={{ paddingLeft: 25, paddingRight: 25 }}><Spinner size=\"small\" /></Button>,\r\n        };\r\n\r\n        this.state = {\r\n            button: this.button.loading,\r\n            player: {\r\n                name: this.props.fetchedUser.first_name,\r\n                nickname: this.props.fetchedUser.nickname\r\n                    ? this.props.fetchedUser.nickname\r\n                    : <div onClick={this.props.go} data-to=\"edit\">{'Указать игровой ник'} <Icon24Write width={12} height={12} style={{ display: 'inline-block' }} /></div>,\r\n                sex: this.props.fetchedUser.sex,\r\n            },\r\n        };\r\n\r\n        this.updateButton = this.updateButton.bind(this);\r\n        this.register = this.register.bind(this);\r\n        this.confirmRegister = this.confirmRegister.bind(this);\r\n        this.cancelRegister = this.cancelRegister.bind(this);\r\n    }\r\n\r\n    confirmRegister() {\r\n        this.props.setPopout(<Alert\r\n                actions={[{\r\n                    title: 'Отмена',\r\n                    autoclose: true,\r\n                    style: 'cancel'\r\n                }, {\r\n                    title: 'Записаться',\r\n                    autoclose: true,\r\n                    action: this.register,\r\n                }]}\r\n                onClose={() => this.props.setPopout(null)}\r\n            >\r\n                <h2>Вы хотите записаться?</h2>\r\n                <p>Отменить запись можно будет только через сообщения сообщества.</p>\r\n            </Alert>\r\n        );\r\n    }\r\n\r\n    cancelRegister() {\r\n        this.props.setPopout(<Alert\r\n                actionsLayout='vertical'\r\n                actions={[{\r\n                    title: 'Сообщения сообщества',\r\n                    autoclose: true,\r\n                    style: 'destructive',\r\n                    action: this.register,\r\n                }, {\r\n                    title: 'Закрыть',\r\n                    autoclose: true,\r\n                    style: 'cancel',\r\n                }]}\r\n                onClose={() => this.props.setPopout(null)}\r\n            >\r\n                <h2>Отмена записи</h2>\r\n                <p>Запись можно отменить только через сообщения сообщества.</p>\r\n            </Alert>\r\n        );\r\n    }\r\n\r\n    async register() {\r\n        this.setState({ button: this.button.loading });\r\n        let success = await Mafia.addToGame(this.props.fetchedUser.id)\r\n        this.setState({\r\n            button: (success)\r\n                ? this.button.signed\r\n                : this.button.signup\r\n        });\r\n    }\r\n\r\n    async updateButton() {\r\n        let in_game = await Mafia.isPlayerInGame(this.props.fetchedUser.id);\r\n        this.setState({\r\n            button: in_game\r\n                ? this.button.signed\r\n                : this.button.signup\r\n        });\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.updateButton();\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        this.updateButton();\r\n    }\r\n\r\n    render() {\r\n        if (!this.props.fetchedUser)\r\n            return null;\r\n\r\n        return (\r\n        <Group>\r\n            <Cell\r\n              photo={this.props.fetchedUser.photo_200}\r\n              description={this.state.player.name}\r\n              bottomContent={this.state.button}\r\n              before={<Avatar src={this.props.fetchedUser.photo_200} size={80}/>}\r\n              size=\"l\"\r\n              style={{fontSize: '1.2em'}}\r\n            >\r\n                { this.state.player.nickname }\r\n            </Cell>\r\n        </Group>\r\n        );\r\n    }\r\n}\r\n\r\nUserPanel.propTypes = {\r\n    go: PropTypes.func.isRequired,\r\n\tfetchedUser: PropTypes.shape({\r\n\t\tid: PropTypes.number,\r\n\t\tphoto_200: PropTypes.string,\r\n        name: PropTypes.string.isRequired,\r\n        nickname: PropTypes.string,\r\n\t\tfirst_name: PropTypes.string,\r\n\t\tlast_name: PropTypes.string,\r\n\t\tcity: PropTypes.shape({\r\n\t\t\ttitle: PropTypes.string,\r\n        }),\r\n        sex: PropTypes.number,\r\n    }),\r\n    setPopout: PropTypes.func,\r\n};\r\n\r\nexport default UserPanel;\r\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport {Panel, PanelHeader, PullToRefresh} from '@vkontakte/vkui';\n\nimport RegistredPlayers from './RegistredPlayers';\nimport UserPanel from './UserPanel';\n\nclass Home extends React.Component {\n// const Home = ({ id, go, fetchedUser, setPopout }) => {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = { fetching: false };\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<Panel id={this.props.id}>\n\t\t\t\t<PanelHeader>Мафия | Елабуга</PanelHeader>\n\t\t\t\t{this.props.fetchedUser &&\n\t\t\t\t<PullToRefresh onRefresh={() => this.forceUpdate()} isFetching={this.state.fetching}>\n\t\t\t\t\t<UserPanel fetchedUser={this.props.fetchedUser} setPopout={this.props.setPopout} go={this.props.go} />\n\t\t\t\t\t<RegistredPlayers fetchedUser={this.props.fetchedUser} />\n\t\t\t\t</PullToRefresh>}\n\t\t\t</Panel>\n\t\t);\n\t}\n}\n\nHome.propTypes = {\n\tid: PropTypes.string.isRequired,\n\tgo: PropTypes.func.isRequired,\n\tfetchedUser: PropTypes.shape({\n\t\tid: PropTypes.number,\n\t\tphoto_200: PropTypes.string,\n\t\tfirst_name: PropTypes.string,\n\t\tlast_name: PropTypes.string,\n\t\tcity: PropTypes.shape({\n\t\t\ttitle: PropTypes.string,\n\t\t}),\n\t}),\n\tsetPopout: PropTypes.func.isRequired,\n};\n\nexport default Home;\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { PanelHeader, HeaderButton, platform, IOS, Panel, FormLayout, Input, FormLayoutGroup, Radio, Button, Spinner } from '@vkontakte/vkui';\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\r\n\r\nimport Mafia from '../mafia';\r\n// import Icon24Write from '@vkontakte/icons/dist/24/write';\r\n\r\nconst osname = platform();\r\n\r\nclass EditPanel extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        let nicknameExists = this.props.fetchedUser.nickname !== null;\r\n        this.state = {\r\n            name: this.props.fetchedUser.name,\r\n            nickname: nicknameExists ? this.props.fetchedUser.nickname : '',\r\n            sex: this.props.fetchedUser.sex,\r\n            nickname_class: 'default',\r\n            nickname_text: 'Ник должен состоять только из русских букв',\r\n        };\r\n\r\n        this.onChange = this.onChange.bind(this);\r\n        this.onSubmit = this.onSubmit.bind(this);\r\n        this.back = this.back.bind(this);\r\n    }\r\n\r\n    onChange(e) {\r\n        console.log(e);\r\n        const { name, value } = e.currentTarget;\r\n        this.setState({ [name]: value });\r\n\r\n        if (name === 'nickname') {\r\n            let validChars = value === '' || !/([^А-Яа-я]+)/i.test(value);\r\n            this.setState({\r\n                nickname_class: validChars ? 'default' : 'error',\r\n                nickname_text: validChars ? this.state.nickname_text : 'Ник должен состоять только из русских букв',\r\n            });\r\n            clearTimeout(this.TimerID);\r\n            if (!validChars) return;\r\n        }\r\n\r\n        this.setState({ nickname_text: <Spinner size=\"small\" /> });\r\n        this.TimerID = setTimeout(function () {\r\n            Mafia.getPlayerByNickname(value)\r\n                .then(player => {\r\n                    player = player && value === this.props.fetchedUser.nickname ? true : false;\r\n                    this.setState({\r\n                        nickname_class: (player === false)\r\n                            ? 'valid'\r\n                            : 'error',\r\n                        nickname_text: (player === false)\r\n                            ? 'Ник свободен'\r\n                            : 'Игрок с таким ником уже существует'\r\n                    });\r\n                });\r\n        }.bind(this), 750);\r\n    }\r\n\r\n    onSubmit(e) {\r\n        const {...event} = e;\r\n        if (this.state.name === '') return false;\r\n        if (this.state.nickname !== '' &&\r\n            this.state.nickname_class !== 'valid' &&\r\n            this.state.nickname !== this.props.fetchedUser.nickname\r\n           )\r\n            return false;\r\n\r\n        Mafia.updatePlayer(this.props.fetchedUser.id, {\r\n            nickname: this.state.nickname,\r\n            name: this.state.name,\r\n            sex: this.state.sex,\r\n        })\r\n        .then(success => {\r\n            if (success === true)\r\n                this.props.go(event);\r\n            else\r\n                console.warn('Cant save nickname');\r\n        });\r\n    }\r\n\r\n    back(e) {\r\n        this.props.go(e);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <Panel id={this.props.id}>\r\n\t\t\t\t<PanelHeader\r\n                    left={<HeaderButton onClick={this.back} data-to=\"home\">{osname === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}</HeaderButton>}\r\n                >\r\n                    Мафия | Редактирование\r\n                </PanelHeader>\r\n\t\t\t\t{this.props.fetchedUser &&\r\n                    <FormLayout>\r\n                        <Input\r\n                            type=\"text\"\r\n                            top=\"Имя\"\r\n                            name=\"name\"\r\n                            value={this.state.name}\r\n                            onChange={this.onChange}\r\n                        />\r\n\r\n                        <FormLayoutGroup top=\"Как к Вам обращаться?\">\r\n                            <Radio name=\"sex\" defaultChecked={this.state.sex === 1}>Господин</Radio>\r\n                            <Radio name=\"sex\" defaultChecked={this.state.sex === 0}>Госпожа</Radio>\r\n                        </FormLayoutGroup>\r\n\r\n                        <Input\r\n                            type=\"text\"\r\n                            top=\"Игровой ник\"\r\n                            name=\"nickname\"\r\n                            value={this.state.nickname}\r\n                            onChange={this.onChange}\r\n                            status={this.state.nickname_class}\r\n                            bottom={this.state.nickname_text}\r\n                        />\r\n\r\n                        <Button size=\"xl\" onClick={(e) => this.onSubmit(e)} data-to=\"home\">Сохранить</Button>\r\n                    </FormLayout>}\r\n\t\t\t</Panel>\r\n        );\r\n    }\r\n}\r\n\r\nEditPanel.propTypes = {\r\n    id: PropTypes.string.isRequired,\r\n    go: PropTypes.func.isRequired,\r\n\tfetchedUser: PropTypes.shape({\r\n\t\tid: PropTypes.number,\r\n        photo_200: PropTypes.string,\r\n        name: PropTypes.string.isRequired,\r\n        nickname: PropTypes.string,\r\n\t\tfirst_name: PropTypes.string,\r\n\t\tlast_name: PropTypes.string,\r\n\t\tcity: PropTypes.shape({\r\n\t\t\ttitle: PropTypes.string,\r\n        }),\r\n        sex: PropTypes.number,\r\n    }),\r\n    setPopout: PropTypes.func,\r\n};\r\n\r\nexport default EditPanel;\r\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { platform, IOS } from '@vkontakte/vkui';\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel';\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\nimport HeaderButton from '@vkontakte/vkui/dist/components/HeaderButton/HeaderButton';\nimport View from '@vkontakte/vkui/dist/components/View/View';\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\n\nimport './Register.css';\n\nconst osName = platform();\n\nconst Register = (props) => {\n\tlet xhr = new XMLHttpRequest();\n\txhr.open('POST', 'https://vkapp.mailpromtrans.ru/api/register');\n\txhr.send(JSON.stringify({\n\t\t'vk_id': props.id\n\t}));\n\tlet success = true;\n\tif (xhr.status !== 200) {\n\t\tsuccess = false;\n\t}\n\tlet result = JSON.parse(xhr.responseText);\n\tif (result.ok === false) {\n\t\tsuccess = false;\n\t}\n\n\tlet jsx = success ? (<View>Вы записаны на игру!</View>) : (<View>Не удалось записать на игру<br />Попробуйте записаться через личные сообщения группы</View>);\n\n\treturn (\n\t\t<Panel id={props.id}>\n\t\t\t<PanelHeader\n\t\t\t\tleft={<HeaderButton onClick={props.go} data-to=\"home\">\n\t\t\t\t\t{osName === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}\n\t\t\t\t</HeaderButton>}\n\t\t\t>\n\t\t\t\t<PanelHeader>Регистрация на Мафию</PanelHeader>\n\t\t\t</PanelHeader>\n\t\t\t{jsx}\n\t\t</Panel>\n\t);\n};\n\nRegister.propTypes = {\n\tid: PropTypes.string.isRequired,\n\tgo: PropTypes.func.isRequired,\n};\n\nexport default Register;\n","import React, { useState, useEffect } from 'react';\nimport connect from '@vkontakte/vk-connect';\nimport {View, ScreenSpinner} from '@vkontakte/vkui';\nimport '@vkontakte/vkui/dist/vkui.css';\n\nimport Home from './panels/Home';\nimport EditPanel from './panels/EditPanel';\nimport Register from './panels/Register';\nimport Mafia from './mafia';\n\nconst App = () => {\n\tconst [activePanel, setActivePanel] = useState('home');\n\tconst [fetchedUser, setUser] = useState(null);\n\tconst [popout, setPopout] = useState(<ScreenSpinner size='large' />);\n\n\tuseEffect(() => {\n\t\tconnect.subscribe(({ detail: { type, data }}) => {\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\n\t\t\t\tconst schemeAttribute = document.createAttribute('scheme');\n\t\t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\n\t\t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\n\t\t\t}\n\t\t});\n\t\tasync function fetchData() {\n\t\t\tlet user = await connect.send('VKWebAppGetUserInfo');\n\t\t\tlet player = await Mafia.getPlayer(user.id);\n\t\t\tif (player === false) {\n\t\t\t\tawait Mafia.registerPlayer(user.id);\n\t\t\t\tplayer = await Mafia.getPlayer(user.id);\n\t\t\t}\n\t\t\tuser = Object.assign(user, player);\n\t\t\tsetUser(user);\n\n\t\t\tsetPopout(null);\n\t\t}\n\t\tfetchData();\n\t}, []);\n\n\tconst go = e => {\n\t\tsetActivePanel(e.currentTarget.dataset.to);\n\t};\n\n\treturn (\n\t\t<View activePanel={activePanel} popout={popout}>\n\t\t\t<Home id='home' fetchedUser={fetchedUser} go={go} setPopout={setPopout} />\n\t\t\t<EditPanel id='edit' fetchedUser={fetchedUser} go={go} setPopout={setPopout} />\n\t\t\t<Register id='register' go={go} />\n\t\t</View>\n\t);\n}\n\nexport default App;\n\n","import 'core-js/features/map';\nimport 'core-js/features/set';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport connect from '@vkontakte/vk-connect';\nimport App from './App';\n// import registerServiceWorker from './sw';\n\n// Init VK  Mini App\nconnect.send('VKWebAppInit');\n\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\n// расскомментируйте строку с registerServiceWorker();\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\n// registerServiceWorker();\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}